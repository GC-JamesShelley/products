FROM node:12

# Setting working directory. All the path will be relative to WORKDIR
WORKDIR /usr/src/app

COPY package.json .
COPY yarn.lock .
RUN yarn

COPY next.config.js .
COPY tsconfig.json .
COPY .babelrc .

# Installing dependencies
COPY ./src ./src

ARG AZURE_SEARCH_API_VERSION
ARG AZURE_SEARCH_EXACTNESS_BOOST
ARG AZURE_SEARCH_INDEX
ARG AZURE_SEARCH_KEY
ARG AZURE_SEARCH_SCORING_PROFILE
ARG AZURE_SEARCH_SERVICE
ARG AZURE_SEARCH_WORD_FUZZINESS

ENV AZURE_SEARCH_API_VERSION=${AZURE_SEARCH_API_VERSION}
ENV AZURE_SEARCH_EXACTNESS_BOOST=${AZURE_SEARCH_EXACTNESS_BOOST}
ENV AZURE_SEARCH_INDEX=${AZURE_SEARCH_INDEX}
ENV AZURE_SEARCH_KEY=${AZURE_SEARCH_KEY}
ENV AZURE_SEARCH_SCORING_PROFILE=${AZURE_SEARCH_SCORING_PROFILE}
ENV AZURE_SEARCH_SERVICE=${AZURE_SEARCH_SERVICE}
ENV AZURE_SEARCH_WORD_FUZZINESS=${AZURE_SEARCH_WORD_FUZZINESS}

RUN yarn build

# Running the app
CMD ["yarn", "start"]
